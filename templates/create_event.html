{% extends 'base.html' %}

{% block content %}
    <h1>Create Event</h1>

    <form method="POST">
        {% csrf_token %}

        <!-- User Dropdown inside the form -->
        <label for="id_user">Select User</label>
        <select name="user" id="id_user" required>
            <option value="" disabled {% if not selected_user_id %}selected{% endif %}>Select a user</option>
            {% for user in users %}
                <option value="{{ user.id }}" {% if user.id|stringformat:"s" == selected_user_id %}selected{% endif %}>
                    {{ user.username }}
                </option>
            {% endfor %}
        </select>


        <!-- Event fields -->
        <label for="id_name">Event Name</label>
        <input type="text" name="name" maxlength="255" required="" id="id_name">

        <label for="id_description">Description</label>
        <textarea name="description" cols="40" rows="10" required="" id="id_description"></textarea>

        <label for="id_location">Location</label>
        <input type="text" name="location" maxlength="255" id="id_location">

        <label for="id_day">Event Date (No time)</label>
        <input type="date" name="day" required="" id="id_day">

        <label for="id_start_time">Start Time</label>
        <input type="time" name="start_time" required="" id="id_start_time">

        <label for="id_end_time">End Time</label>
        <input type="time" name="end_time" id="id_end_time">

        <!-- Recurrence checkbox -->
        <label for="id_is_recurring">Is this a recurring event?</label>
        <input type="checkbox" name="is_recurring" id="id_is_recurring">

        <!-- Recurrence fields, hidden initially -->
        <div id="recurrence-fields" style="display: none;">
            <label for="id_recurrence_type">Recurrence Type</label>
            <select name="type" id="id_type">
                <option value="DAILY" selected>Daily</option>
                <option value="WEEKLY">Weekly</option>
                <option value="MONTHLY">Monthly</option>
                <option value="YEARLY">Yearly</option>
                <option value="CUSTOM">Custom Interval</option>
            </select>

            <!-- Interval field, initially hidden -->
            <div id="interval-field" style="display: none;">
                <label for="id_interval">Interval (e.g., every 2 days/weeks/months)</label>
                <input type="number" name="interval" value="1" min="0" required="" id="id_interval">
            </div>

            <!-- Measurement Type field, initially hidden -->
            <div id="measurement-type-field" style="display: none;">
                <label for="id_measurement_type">Measure Interval</label>
                <select name="measurement_type" id="id_measurement_type">
                    <option value="DAYS">Days</option>
                    <option value="WEEKS">Weeks</option>
                    <option value="MONTHS">Months</option>
                    <option value="YEARS">Years</option>
                </select>
            </div>
        </div>

        <button type="submit">Create Event</button>
    </form>

    <a href="/events/">
        <button class="btn-secondary">Back to Event List</button>
    </a>

    <script>
        // Show recurrence fields when the checkbox is checked
        const recurringCheckbox = document.getElementById('id_is_recurring');
        const recurrenceFields = document.getElementById('recurrence-fields');
        const recurrenceType = document.getElementById('id_type');
        const intervalField = document.getElementById('interval-field');
        const measurementTypeField = document.getElementById('measurement-type-field');

        recurringCheckbox.addEventListener('change', function () {
            if (this.checked) {
                recurrenceFields.style.display = 'block';
            } else {
                recurrenceFields.style.display = 'none';
                intervalField.style.display = 'none';
                measurementTypeField.style.display = 'none';
            }
        });

        // Show interval and measure type only if 'Custom' is selected in recurrence type
        recurrenceType.addEventListener('change', function () {
            if (this.value === 'CUSTOM') {
                intervalField.style.display = 'block';
                measurementTypeField.style.display = 'block';
            } else {
                intervalField.style.display = 'none';
                measurementTypeField.style.display = 'none';
            }
        });
    </script>

{% endblock %}
